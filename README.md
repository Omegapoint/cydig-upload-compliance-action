[![OP Compliance Dashboard](https://img.shields.io/badge/OP%20Compliance%20Dashboard-click%20here-blue)](https://cydig.omegapoint.cloud/cydig)<br/><br/>
![Timestamp](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3Dtimestamp)<br/><br/>
![threatModelingDate](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DthreatModelingDate)<br/>
[![numberOfReviewers](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DnumberOfReviewers)](https://dev.azure.com/CyDig/CyDig/_settings/repositories?repo=04d838da-ac18-46bd-8fe7-5786997062d8&_a=policiesMid&refs=refs/heads/main)<br/>
![numberOfExposedSecrets](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DnumberOfExposedSecrets)<br/>
![codeQualityTool](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DcodeQualityTool)<br/>
![scaTool](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DscaTool)<br/>
![sastTool](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DsastTool)<br/>
[![secureScore](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DsecureScore)](https://portal.azure.com/#view/Microsoft_Azure_Security/RecommendationsBladeV2/subscriptionIds~/%5B%2215c6235f-9e0f-4073-baf4-4fd0a7913d76%22%5D/source/SecurityPosture_ViewRecommendation)<br/>
[![allowedLocationPolicy](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DallowedLocationPolicy)](https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Compliance)<br/>
![usersInProduction](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DusersInProduction)<br/>
![numberOfDeployedVMs](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DnumberOfDeployedVMs)<br/>
![pentestDate](https://img.shields.io/endpoint?url=https%3A%2F%2Ffunc-cydig-comp-state-prod.azurewebsites.net%2Fapi%2FReadToReadme%3Fcode%3DxaEvCDsaK01y2Z6SBivwOKndN4o915lpOTt1VkmULgsxgsjkml7u1DOhgULzmAPX%26teamName%3DCyDig%26teamProjectName%3DCyDig%26codeRepositoryName%3Dupload-compliance-state-task%26stateType%3DpentestDate)<br/>

# Upload Compliance State Task

This repository contains the upload compliance state task.

## Development on already existing task (uploadcompliancestatetask)

To start development, create a branch named **feature/your-branch-name**.

Run the command below from the root.

```bash
npm install
cd name-of-folder-containing-task
npm install
```

By first running `npm install` in the root you get the linting and format rules downloaded. So, every time you make a commit, a pre-hook will run to validate the rules. If there are any violation you will se an error or a warning in the terminal. Read more [here](https://dev.azure.com/CyDig/CyDig/_git/upload-compliance-state-task?path=/LinitingAndFormat.md) To fix format warnings run the following command from the **root**:

```bash
npm run format:write
```

Start developing and create tests, to run your test run: `npm run test`. When you are happy with your changes, **change the task version in task.json** located in the folder of the task you've been working on. When pushing the code the pipeline _Deploy CyDig Upload Task Extension_ will trigger. The pipeline will deploy to the dev task. You can test the task by running pipelines _one-task-pipeline_ or _Dev Central scan_.

When you are happy with your changes, make a pull request to main.

## Development of new task

Start with creating a branch named **feature/your-branch-name**.

1. Create a new folder in the root of the repository. Move into the folder and run `npm init`, fill in the values. In entry point, write **js_out/index.js**.
2. Add the following section in the package.json:

```bash
  "scripts": {
    "build": "tsc",
    "start": "npm run build && node js_out/index.js",
    "test": "npm run build && mocha js_out/test/",
    "testScript": "npm run build && mocha js_out/test/ --reporter xunit --reporter-option output=ResultsFile.xml"
  },
```

3. Copy the tsconfig.json from another task.
4. Make a task.json, one example is [here](https://learn.microsoft.com/en-us/azure/devops/extend/develop/add-build-task?view=azure-devops#create-custom-task). You could also take inspiration from other tasks. You should set the id, name and friendlyName as shown below:

```bash
  "id": "###id###",
  "name": "###name###",
  "friendlyName": "###friendlyname###",
```

5. Add the variables above to the variable groups: **task-deploy-dev** and **task-deploy-prod**. The name of the variables should be _nameoffolder-id/name/friendly-name_ (see other variables for inspiration). Important that you generate a new id (different for dev and prod), [here](https://www.uuidgenerator.net/) you can generate one.
6. Add the task to files and contributions in vss-extension.json.
7. Add task to parameters in **azure-pipeline.yml**.
8. Add the **icon.png** from another task to the root of the task you are developing.
9. Add the task to **overview.md**
10. Start developing!
11. Make tests, if you don't have a test folder with at least 1 test, the pipeline won't work (you need to install mocha).
12. REMEMBER TO RUN NPM I BEFORE PUSHING
13. Push the code and verify that the pipeline _Deploy CyDig Upload Task Extension_ is triggered.
14. Make a pull request to main.

**Every time you make changes to you task, remember to update the task version in task.json!**

### Deploying a new extension

Read more [here](https://dev.azure.com/CyDig/CyDig/_git/cydig-tasks?path=/new-extension.md) - should not be done often.
